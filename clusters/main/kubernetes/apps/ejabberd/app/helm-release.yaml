---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: ejabberd
  namespace: ejabberd
spec:
  interval: 15m
  chart:
    spec:
      chart: ./charts/incubator/ejabberd
      version: 0.0.1
      sourceRef:
        kind: GitRepository
        name: oreste
        namespace: flux-system
      interval: 15m
  timeout: 20m
  maxHistory: 3
  driftDetection:
    mode: warn
  install:
    createNamespace: true
    remediation:
      retries: 3
  upgrade:
    cleanupOnFail: true
    remediation:
      retries: 3
  uninstall:
    keepHistory: false
  values:
    ingress:
      web-admin:
        primary: true
        ingressClassName: internal
        enabled: true
        hosts:
          - host: "ejabberd.cloud.local"
            paths:
              - path: /
        tls:
          - hosts:
              - ejabberd.cloud.local
    configmap:
      config:
        enabled: true
        data:
          ejabberd.yml: |
            loglevel: debug
            hosts:
              - localhost
              - 127.0.0.1
              - ejabberd.ejabberd.svc.cluster.local
              - ejabberd.cloud.local
            listen:
              -
                ip: "0.0.0.0"
                port: 5280
                module: ejabberd_http
                tls: false
                request_handlers:
                  /admin: ejabberd_web_admin

            
